extends Effect

var buildup : float = 0
@export var seconds_threshold : float = 0.5
@export var immunity : float = 0.5
@export var tick_damage : DamageData
var immunity_frames : float

func _init() -> void:
	if not tick_damage:
		tick_damage = DamageData.new()
		tick_damage.damage = 1
		tick_damage.damage_type = tick_damage.DamageTypes.fire

func _process(delta : float) -> void:
	var entity : Entity = (get_parent() as EntityComponent).parent
	if FloorHandler.is_point_in_fire(entity.global_position):
		buildup += delta
	elif buildup > 0.0:
		buildup -= min(delta * 2, buildup)
	if buildup > 1.0 and immunity_frames < 0.01:
		entity.distribute_signal(TakeDamageEvent.new(tick_damage, Vector2.ZERO))
		immunity_frames = immunity
	if immunity_frames > 0:
		immunity_frames -= delta

func handle_event(event : Event) -> Event:
	return event
